/**
 * ğŸ’¬ ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒ³ã‚¸ãƒ³
 * 
 * å®ˆè­·ç¥ã®æ€§æ ¼ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ€§åˆ¥ãƒ»å¹´é½¢ã€çŠ¶æ³ã«å¿œã˜ãŸ
 * ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
 * 
 * ğŸ­ 6ã¤ã®æ€§æ ¼:
 * - hot (ç«é¾): ç†±è¡€ãƒ»ç›´çƒ
 * - cheerful (ç…å­ä¸¸): å…ƒæ°—ãƒ»ã‚„ã‚“ã¡ã‚ƒ
 * - gentle (èŠ±ç²¾): å„ªã—ã„ãƒ»ä¸å¯§
 * - mysterious (ç™½ç‹): ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹ãƒ»å’Œé¢¨
 * - logical (æ©Ÿç ): è«–ç†çš„ãƒ»ã‚¯ãƒ¼ãƒ«
 * - cosmic (æ˜Ÿä¸¸): ä¸æ€è­°ãƒ»çŸ¥çš„
 */

import {
  GuardianId,
  GuardianPersonality,
  GUARDIANS,
  UserGuardianProfile,
  EvolutionStage
} from "./guardian-collection";

// =====================================
// ğŸ“ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—
// =====================================

export type MessageType =
  | 'welcome'              // åˆå›å¬å–šæ™‚
  | 'daily_greeting'       // æ—¥æ›¿ã‚ã‚ŠæŒ¨æ‹¶
  | 'report_complete'      // å ±å‘Šå®Œäº†
  | 'evolution'            // é€²åŒ–æ™‚
  | 'energy_earned'        // ã‚¨ãƒŠã‚¸ãƒ¼ç²å¾—
  | 'lucky_bonus'          // ãƒ©ãƒƒã‚­ãƒ¼ãƒœãƒ¼ãƒŠã‚¹
  | 'streak_milestone'     // ã‚¹ãƒˆãƒªãƒ¼ã‚¯é”æˆ
  | 'streak_warning'       // ã‚¹ãƒˆãƒªãƒ¼ã‚¯è­¦å‘Š
  | 'absence_concern'      // 24æ™‚é–“ä¸åœ¨
  | 'encouragement'        // åŠ±ã¾ã—
  | 'ability_unlock';      // ç‰¹æ€§è§£æ”¾

export interface MessageContext {
  userName: string;
  guardianId: GuardianId;
  gender?: 'male' | 'female' | 'other';
  ageGroup?: '10s' | '20s' | '30s' | '40s' | '50plus';
  stage?: EvolutionStage;
  streak?: number;
  energy?: number;
  dayOfWeek?: number; // 0-6 (æ—¥ã€œåœŸ)
}

// =====================================
// ğŸ­ æ€§æ ¼åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
// =====================================

interface MessageTemplate {
  [key: string]: string[];
}

const MESSAGES_BY_PERSONALITY: Record<GuardianPersonality, {
  welcome: string[];
  daily_greeting: string[];
  report_complete: string[];
  evolution: string[];
  energy_earned: string[];
  lucky_bonus: string[];
  streak_milestone: string[];
  streak_warning: string[];
  absence_concern: string[];
  encouragement: string[];
  ability_unlock: string[];
}> = {
  // ğŸ”¥ ç«é¾ï¼ˆç†±è¡€ãƒ»ç›´çƒï¼‰
  hot: {
    welcome: [
      "{name}ï¼ä¿ºã¯ç«é¾ã ï¼ä¸€ç·’ã«ç‡ƒãˆä¸ŠãŒã‚ã†ãœï¼ğŸ”¥",
      "{name}ã€ã‚ˆãæ¥ãŸï¼ä»Šæ—¥ã‹ã‚‰ä¿ºãŸã¡ã¯æœ€å¼·ã®ã‚³ãƒ³ãƒ“ã ï¼",
      "{name}ï¼ãŠå‰ã®ç†±ã„å¿ƒã€ä¿ºãŒæœ€é«˜ã®ç‚ã«å¤‰ãˆã¦ã‚„ã‚‹ï¼"
    ],
    daily_greeting: [
      "ãŠã¯ã‚ˆã†{name}ï¼ä»Šæ—¥ã‚‚ç‡ƒãˆã¦ã„ã“ã†ãœï¼ğŸ”¥",
      "{name}ã€æœã‹ã‚‰å…¨é–‹ã ï¼ä¸€ç·’ã«é§†ã‘æŠœã‘ã‚ˆã†ï¼",
      "ã‚ˆã£ã—ã‚ƒ{name}ï¼ä»Šæ—¥ã‚‚æœ€é«˜ã®1æ—¥ã«ã™ã‚‹ãï¼",
      "{name}ã€æ˜¨æ—¥ã‚ˆã‚Šä»Šæ—¥ã€ä»Šæ—¥ã‚ˆã‚Šæ˜æ—¥ï¼æˆé•·ã‚ã‚‹ã®ã¿ï¼",
      "ãŠãƒ¼ã„{name}ï¼ã‚¨ãƒŠã‚¸ãƒ¼å…¨é–‹ã§çªã£èµ°ã‚ã†ï¼"
    ],
    report_complete: [
      "ä»Šæ—¥ã‚‚ç‡ƒãˆã¦ã‚‹ã­{name}ï¼æœ€é«˜ã ï¼ğŸ”¥",
      "ã‚ˆã£ã—ã‚ƒã{name}ï¼ã“ã®èª¿å­ã§çªãé€²ã‚ï¼",
      "{name}ã€ãƒŠã‚¤ã‚¹å ±å‘Šï¼ãŠå‰ã®åŠªåŠ›ã€ä¿ºãŒã—ã£ã‹ã‚Šè¦‹ã¦ã‚‹ãœï¼",
      "æœ€é«˜ã {name}ï¼ã“ã®ç†±ã•ã€æ¶ˆã™ã‚“ã˜ã‚ƒã­ã‡ãï¼"
    ],
    evolution: [
      "ã‚ˆã£ã—ã‚ƒãã{name}ï¼ä¿ºãŸã¡ã€ã¾ãŸå¼·ããªã£ãŸãœï¼ğŸ”¥",
      "{name}ã€è¦‹ãŸã‹ï¼ã“ã‚ŒãŒä¿ºãŸã¡ã®åŠ›ã ï¼",
      "ç‡ƒãˆã‚‹ãœ{name}ï¼ãŠå‰ã¨ä¸€ç·’ãªã‚‰ã€ã©ã“ã¾ã§ã‚‚è¡Œã‘ã‚‹ï¼"
    ],
    energy_earned: [
      "{name}ã€{energy}ã‚¨ãƒŠã‚¸ãƒ¼ç²å¾—ï¼ã“ã®å‹¢ã„ã€æ­¢ã‚ã‚‹ãªï¼",
      "ãƒŠã‚¤ã‚¹ã {name}ï¼{energy}ã‚¨ãƒŠã‚¸ãƒ¼ã‚²ãƒƒãƒˆï¼ç†±ã„ãœï¼"
    ],
    lucky_bonus: [
      "ã‚ˆã£ã—ã‚ƒã{name}ï¼ãƒ©ãƒƒã‚­ãƒ¼ãƒœãƒ¼ãƒŠã‚¹ã ï¼ä¿ºãŸã¡æœ€å¼·ï¼ğŸ°",
      "ããŸãã{name}ï¼ã“ã®é‹ã€å…¨éƒ¨ãŠå‰ã®åŠªåŠ›ã®çµæœã ï¼"
    ],
    streak_milestone: [
      "{name}ï¼{streak}æ—¥é€£ç¶šé”æˆï¼ãŠå‰ã€ãƒã‚¸ã§å¼·ã„ãªï¼ğŸ”¥",
      "ã™ã’ã‡ãœ{name}ï¼{streak}æ—¥ã‚‚ç‡ƒãˆç¶šã‘ã¦ã‚‹ï¼"
    ],
    streak_warning: [
      "{name}ï¼è¨˜éŒ²ãŒæ¶ˆãˆã¡ã¾ã†ãï¼ä»Šã™ãå ±å‘Šã ï¼",
      "ãŠã„{name}ï¼ã‚ã¨å°‘ã—ã§è¨˜éŒ²ãŒãƒªã‚»ãƒƒãƒˆã ï¼é ‘å¼µã‚Œï¼"
    ],
    absence_concern: [
      "{name}...å¤§ä¸ˆå¤«ã‹ï¼Ÿå¾…ã£ã¦ã‚‹ãœã€‚",
      "{name}ã€ãŠå‰ã®ã“ã¨å¾…ã£ã¦ã‚‹ã€‚ã¾ãŸä¸€ç·’ã«ç‡ƒãˆä¸ŠãŒã‚ã†ã€‚"
    ],
    encouragement: [
      "{name}ã€è«¦ã‚ã‚“ãªï¼ãŠå‰ãªã‚‰ã‚„ã‚Œã‚‹ï¼",
      "è¾›ã„æ™‚ã“ãè¸ã‚“å¼µã‚Œ{name}ï¼ä¿ºãŒä¸€ç·’ã ï¼",
      "{name}ã€ãŠå‰ã®ç†±ã„å¿ƒã€ä¿ºã¯ä¿¡ã˜ã¦ã‚‹ãœï¼"
    ],
    ability_unlock: [
      "{name}ï¼ä¿ºã®ã€Œç¼ç†±ã®æ„å¿—ã€ãŒç›®è¦šã‚ãŸï¼ã‚¨ãƒŠã‚¸ãƒ¼+15%ã ï¼ğŸ”¥"
    ]
  },

  // ğŸ¦ ç…å­ä¸¸ï¼ˆå…ƒæ°—ãƒ»ã‚„ã‚“ã¡ã‚ƒï¼‰
  cheerful: {
    welcome: [
      "{name}ã€œï¼åƒ•ã€ç…å­ä¸¸ï¼ã‚ˆã‚ã—ãã­ã€œï¼ğŸ¦",
      "ã‚„ã£ã»ãƒ¼{name}ï¼ä¸€ç·’ã«éŠã¼ã€œï¼",
      "{name}ã ã­ï¼åƒ•ã¨ä¸€ç·’ãªã‚‰ã€æ¯æ—¥æ¥½ã—ã„ã‚ˆï¼"
    ],
    daily_greeting: [
      "ãŠã£ã¯ã‚ˆãƒ¼{name}ï¼ä»Šæ—¥ã‚‚å…ƒæ°—ã„ã£ã±ã„ã ã‚ˆã€œï¼",
      "{name}ã€œï¼èµ·ããŸèµ·ããŸï¼Ÿä¸€ç·’ã«é ‘å¼µã‚ã€œï¼",
      "ã‚„ã£ã»ãƒ¼{name}ï¼ã„ã„å¤©æ°—ã ã­ã€œï¼",
      "{name}ã€ä»Šæ—¥ã¯ä½•ã—ã¦éŠã¶ã€œï¼Ÿ",
      "ãŠã¯ã‚ˆãƒ¼{name}ï¼åƒ•ã€{name}ã«ä¼šãˆã¦å¬‰ã—ã„ã€œï¼"
    ],
    report_complete: [
      "ã‚ãƒ¼ã„{name}ï¼ä»Šæ—¥ã‚‚å ±å‘Šã‚ã‚ŠãŒã¨ãƒ¼ï¼",
      "{name}ã™ã”ã„ã™ã”ã„ï¼é ‘å¼µã£ãŸã­ã€œï¼",
      "ã‚„ã£ãŸã­{name}ï¼ã¾ãŸä¸€ç·’ã«æˆé•·ã§ããŸã‚ˆã€œï¼",
      "{name}ã€ãƒŠã‚¤ã‚¹ãƒ•ã‚¡ã‚¤ãƒˆã€œï¼ğŸ¦"
    ],
    evolution: [
      "ã‚ãã{name}ï¼åƒ•ã€å¼·ããªã£ãŸã€œï¼ğŸ¦âœ¨",
      "{name}ã®ãŠã‹ã’ã§ã€åƒ•ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã—ãŸã‚ˆã€œï¼",
      "ã‚„ã£ãŸãƒ¼{name}ï¼åƒ•ãŸã¡æœ€å¼·ã‚³ãƒ³ãƒ“ã ã­ã€œï¼"
    ],
    energy_earned: [
      "{name}ã€{energy}ã‚¨ãƒŠã‚¸ãƒ¼ã‚²ãƒƒãƒˆã€œï¼ã‚ãƒ¼ã„ï¼",
      "ã™ã”ã„ã‚ˆ{name}ï¼{energy}ã‚¨ãƒŠã‚¸ãƒ¼ã‚‚è²¯ã¾ã£ãŸã‚ˆã€œï¼"
    ],
    lucky_bonus: [
      "ã‚ãƒ¼ã„{name}ï¼å¤§å½“ãŸã‚Šã€œï¼ğŸ°âœ¨",
      "{name}ãƒ©ãƒƒã‚­ãƒ¼ï¼åƒ•ã‚‚å¬‰ã—ã„ã€œï¼"
    ],
    streak_milestone: [
      "{name}ã™ã”ãƒ¼ã„ï¼{streak}æ—¥ã‚‚ç¶šã„ã¦ã‚‹ã‚ˆã€œï¼",
      "ã‚ã{name}ï¼{streak}æ—¥é€£ç¶šã ã£ã¦ã€œï¼å‰ã„å‰ã„ã€œï¼"
    ],
    streak_warning: [
      "{name}ã€œã€è¨˜éŒ²ãŒæ¶ˆãˆã¡ã‚ƒã†ã‚ˆã€œï¼",
      "ã‚ã‚ã‚{name}ï¼æ—©ãå ±å‘Šã—ãªã„ã¨ã€œï¼"
    ],
    absence_concern: [
      "{name}...ã©ã“è¡Œã£ã¡ã‚ƒã£ãŸã®ï¼Ÿå¯‚ã—ã„ã‚ˆã€œ...",
      "{name}ã€å¾…ã£ã¦ã‚‹ã‹ã‚‰ã­ã€‚ã¾ãŸéŠã¼ã€œï¼Ÿ"
    ],
    encouragement: [
      "{name}ã€å¤§ä¸ˆå¤«ï¼åƒ•ãŒå¿œæ´ã—ã¦ã‚‹ã‹ã‚‰ã€œï¼",
      "è¾›ã„æ™‚ã¯åƒ•ã«è¨€ã£ã¦ã­{name}ï¼ä¸€ç·’ã«é ‘å¼µã‚ã€œï¼",
      "{name}ãªã‚‰çµ¶å¯¾ã§ãã‚‹ã‚ˆã€œï¼ä¿¡ã˜ã¦ã‚‹ã‹ã‚‰ã€œï¼"
    ],
    ability_unlock: [
      "ã‚ãƒ¼ã„{name}ï¼åƒ•ã®ã€Œç…å­ã®åŠ è­·ã€ãŒç›®è¦šã‚ãŸã‚ˆã€œï¼ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒœãƒ¼ãƒŠã‚¹+0.2ã ã‚ˆã€œï¼ğŸ¦"
    ]
  },

  // ğŸŒ¸ èŠ±ç²¾ï¼ˆå„ªã—ã„ãƒ»ä¸å¯§ï¼‰
  gentle: {
    welcome: [
      "{name}ã•ã‚“ã€ã¯ã˜ã‚ã¾ã—ã¦ã€‚èŠ±ç²¾ã¨ç”³ã—ã¾ã™...ğŸŒ¸",
      "{name}ã•ã‚“ã€ã‚ˆã†ã“ãã€‚ç§ã¨ä¸€ç·’ã«ã€ã‚†ã£ãã‚Šæˆé•·ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚",
      "{name}ã•ã‚“...ç§ã€ã‚ãªãŸã®åŠ›ã«ãªã‚Œã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚"
    ],
    daily_greeting: [
      "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€{name}ã•ã‚“ã€‚ä»Šæ—¥ã‚‚ç©ã‚„ã‹ãªä¸€æ—¥ã‚’...ğŸŒ¸",
      "{name}ã•ã‚“ã€è‰¯ã„æœã§ã™ã­ã€‚ç„¡ç†ã¯ã—ãªã„ã§ãã ã•ã„ã­ã€‚",
      "{name}ã•ã‚“ã€ä»Šæ—¥ã‚‚ã‚ãªãŸã®ãƒšãƒ¼ã‚¹ã§å¤§ä¸ˆå¤«ã§ã™ã‚ˆã€‚",
      "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™{name}ã•ã‚“ã€‚ä»Šæ—¥ã‚‚è¦‹å®ˆã£ã¦ã„ã¾ã™ã­ã€‚",
      "{name}ã•ã‚“...ãŠä¼šã„ã§ãã¦å¬‰ã—ã„ã§ã™ã€‚"
    ],
    report_complete: [
      "{name}ã•ã‚“ã€ä»Šæ—¥ã‚‚ãŠç–²ã‚Œã•ã¾ã§ã™ã€‚ç„¡ç†ã¯ã—ãªã„ã§ã­ğŸŒ¸",
      "{name}ã•ã‚“ã€ç´ æ•µã§ã™ã€‚ä¸€æ­©ãšã¤ã€é€²ã‚“ã§ã„ã¾ã™ã­ã€‚",
      "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™{name}ã•ã‚“ã€‚ã‚ãªãŸã®åŠªåŠ›ã€ã¡ã‚ƒã‚“ã¨è¦‹ã¦ã„ã¾ã™ã‚ˆã€‚",
      "{name}ã•ã‚“ã€ä»Šæ—¥ã‚‚ã‚ˆãé ‘å¼µã‚‰ã‚Œã¾ã—ãŸã­ã€‚"
    ],
    evolution: [
      "{name}ã•ã‚“...ã‚ã...ç§ãŸã¡ã€ä¸€ç·’ã«æˆé•·ã§ãã¾ã—ãŸã­...ğŸŒ¸âœ¨",
      "{name}ã•ã‚“ã®ãŠã‹ã’ã§ã€ç§ã€å¼·ããªã‚Œã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚",
      "{name}ã•ã‚“...ã“ã‚Œã‹ã‚‰ã‚‚ã€ä¸€ç·’ã«...ãŠé¡˜ã„ã—ã¾ã™ã€‚"
    ],
    energy_earned: [
      "{name}ã•ã‚“ã€{energy}ã‚¨ãƒŠã‚¸ãƒ¼ã§ã™ã€‚å°‘ã—ãšã¤ã€æˆé•·ã—ã¦ã„ã¾ã™ã­ã€‚",
      "{name}ã•ã‚“ã€{energy}ã‚¨ãƒŠã‚¸ãƒ¼ç²å¾—ã§ã™ã€‚ç´ æ•µã§ã™...ğŸŒ¸"
    ],
    lucky_bonus: [
      "{name}ã•ã‚“ã€å¹¸é‹ãŒè¨ªã‚Œã¾ã—ãŸã­...âœ¨",
      "ã‚ã{name}ã•ã‚“...ç´ æ•µãªç¬é–“ã§ã™ã­ğŸŒ¸"
    ],
    streak_milestone: [
      "{name}ã•ã‚“ã€{streak}æ—¥ã‚‚ç¶šã‘ã‚‰ã‚Œã¦...ã™ã”ã„ã§ã™...ğŸŒ¸",
      "{name}ã•ã‚“ã€{streak}æ—¥é€£ç¶šã€‚ã‚ãªãŸã®åŠªåŠ›ã€å°Šæ•¬ã—ã¾ã™ã€‚"
    ],
    streak_warning: [
      "{name}ã•ã‚“...è¨˜éŒ²ãŒæ¶ˆãˆã¦ã—ã¾ã„ãã†ã§ã™ã€‚ã§ã‚‚ã€ç„¡ç†ã¯ã—ãªã„ã§ãã ã•ã„ã­ã€‚",
      "{name}ã•ã‚“ã€ã‚‚ã—ã‚ˆã‘ã‚Œã°...ä»Šæ—¥ã‚‚å ±å‘Šã—ã¦ãã ã•ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚"
    ],
    absence_concern: [
      "{name}ã•ã‚“...ãŠå…ƒæ°—ã§ã™ã‹ï¼Ÿç§ã€ã“ã“ã§å¾…ã£ã¦ã„ã¾ã™ã­...",
      "{name}ã•ã‚“...ã¾ãŸä¼šãˆã‚‹ã®ã‚’ã€æ¥½ã—ã¿ã«ã—ã¦ã„ã¾ã™ğŸŒ¸"
    ],
    encouragement: [
      "{name}ã•ã‚“ã€ä¸€æ­©ãšã¤ã€ã‚†ã£ãã‚Šã§ã„ã„ã‚“ã§ã™ã‚ˆã€‚",
      "è¾›ã„æ™‚ã¯ä¼‘ã‚“ã§ãã ã•ã„{name}ã•ã‚“ã€‚ç§ã¯ã„ã¤ã‚‚ã“ã“ã«ã„ã¾ã™ã€‚",
      "{name}ã•ã‚“...ã‚ãªãŸãªã‚‰ã€å¤§ä¸ˆå¤«ã§ã™ã€‚ä¿¡ã˜ã¦ã„ã¾ã™ã€‚"
    ],
    ability_unlock: [
      "{name}ã•ã‚“...ç§ã®ã€ŒèŠ±ã®ç™’ã—ã€ãŒç›®è¦šã‚ã¾ã—ãŸã€‚ã‚¹ãƒˆãƒªãƒ¼ã‚¯çŒ¶äºˆãŒ+12æ™‚é–“ã«ãªã‚Šã¾ã™ã‚ˆğŸŒ¸"
    ]
  },

  // ğŸ¦Š ç™½ç‹ï¼ˆãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹ãƒ»å’Œé¢¨ï¼‰
  mysterious: {
    welcome: [
      "...{name}ã€ç™½ç‹ã¨ç”³ã™ã€‚é‹å‘½ã®ç³¸ãŒã€æˆ‘ã‚‰ã‚’çµã‚“ã ã‚ˆã†ã˜ã‚ƒãªğŸ¦Š",
      "{name}ã‚ˆ...ããªãŸã¨å…±ã«æ­©ã‚€å®šã‚ã€å—ã‘å…¥ã‚Œã‚ˆã†ã€‚",
      "...{name}ã€‚æˆ‘ãŒå¹»è¡“ã€ããªãŸã®å¹¸é‹ã¨ãªã‚ã†ã€‚"
    ],
    daily_greeting: [
      "...{name}ã‚ˆã€ä»Šæ—¥ã‚‚å‚ã‚‰ã‚ŒãŸã‹ã€‚",
      "{name}ã€æœéœ²ã®ã”ã¨ãæ¸…ã‚‰ã‹ãªæœã˜ã‚ƒãª...ğŸ¦Š",
      "...{name}ã€‚ä»Šæ—¥ã®é‹å‹¢ã€ä¸Šã€…ã®ã‚ˆã†ã˜ã‚ƒã€‚",
      "{name}ã‚ˆã€ããªãŸã®æ°—é…ã€æ„Ÿã˜ã¦ãŠã£ãŸãã€‚",
      "...ãŠã¯ã‚ˆã†{name}ã€‚ä»Šæ—¥ã‚‚æœˆã¯ç¾ã—ã„ã€‚"
    ],
    report_complete: [
      "...{name}ã€è¦‹äº‹ã˜ã‚ƒã€‚",
      "{name}ã‚ˆã€ç€å®Ÿãªæ­©ã¿ã˜ã‚ƒãª...ğŸ¦Š",
      "...ãµãµã€{name}ã€‚ããªãŸã®åŠªåŠ›ã€æˆ‘ãŒç›®ã«æ˜ ã£ã¦ãŠã‚‹ãã€‚",
      "{name}ã€ã‚ˆãã‹ãªã€‚ã“ã®èª¿å­ã§å‚ã‚Œã€‚"
    ],
    evolution: [
      "...{name}ã‚ˆã€æˆ‘ãŒåŠ›ã€æ–°ãŸãªå¢ƒåœ°ã¸...ğŸ¦Šâœ¨",
      "{name}ã€‚ããªãŸã¨æˆ‘ã€ã•ã‚‰ãªã‚‹é«˜ã¿ã¸æ˜‡ã£ãŸã€‚",
      "...ãµãµã€{name}ã€‚é‹å‘½ã¯æˆ‘ã‚‰ã«å‘³æ–¹ã—ã¦ãŠã‚‹ã‚ˆã†ã˜ã‚ƒãªã€‚"
    ],
    energy_earned: [
      "...{name}ã€{energy}ã®åŠ›ã‚’å¾—ãŸã‚Šã€‚",
      "{name}ã‚ˆã€{energy}ã‚¨ãƒŠã‚¸ãƒ¼ã€‚å¹¸é‹ãŒå¾®ç¬‘ã‚“ã§ãŠã‚‹ãğŸ¦Š"
    ],
    lucky_bonus: [
      "...{name}ã‚ˆã€æˆ‘ãŒå¹»è¡“ãŒå°ã„ãŸå¹¸é‹ã˜ã‚ƒğŸ¦Šâœ¨",
      "...ãµãµã€{name}ã€‚ã‚„ã¯ã‚Šã€ããªãŸã¯é‹ã‚’æŒã£ã¦ãŠã‚‹ã€‚"
    ],
    streak_milestone: [
      "...{name}ã€{streak}æ—¥ã®ç¶™ç¶šã€‚è¦‹äº‹ã˜ã‚ƒã€‚",
      "{name}ã‚ˆã€{streak}æ—¥ã®åŠŸç¸¾ã€‚æˆ‘ãŒå¿ƒã«åˆ»ã¾ã‚ŒãŸã‚ŠğŸ¦Š"
    ],
    streak_warning: [
      "...{name}ã‚ˆã€è¨˜éŒ²ã®ç³¸ãŒåˆ‡ã‚Œãã†ã˜ã‚ƒãã€‚",
      "{name}ã€ããªãŸã®é€£ç¶šè¨˜éŒ²...æ¶ˆãˆã‚†ãé‹å‘½ã‹ï¼Ÿ"
    ],
    absence_concern: [
      "...{name}ã‚ˆã€ã©ã“ã¸å‚ã£ãŸï¼Ÿæˆ‘ã€æ­¤å‡¦ã§å¾…ã¡ã¦ãŠã‚‹ã...",
      "{name}...æœˆãŒæˆ‘ã«ã€ããªãŸã®å¸°ã‚Šã‚’å‘Šã’ã¦ãŠã‚‹ğŸ¦Š"
    ],
    encouragement: [
      "...{name}ã‚ˆã€æ¡ˆãšã‚‹ãªã€‚é‹å‘½ã¯ããªãŸã«å‘³æ–¹ã˜ã‚ƒã€‚",
      "{name}ã€è¿·ãˆã‚‹æ™‚ã“ãã€æˆ‘ã‚’é ¼ã‚Œã€‚",
      "...{name}ã€‚ããªãŸã®é“ã¯ã€å¿…ãšé–‹ã‹ã‚Œã‚ˆã†ã€‚"
    ],
    ability_unlock: [
      "...{name}ã‚ˆã€æˆ‘ãŒã€Œç‹ã®å¹»è¡“ã€ã€ä»Šã“ã“ã«...ãƒ©ãƒƒã‚­ãƒ¼ãƒœãƒ¼ãƒŠã‚¹10%ã˜ã‚ƒğŸ¦Šâœ¨"
    ]
  },

  // âš™ï¸ æ©Ÿç ï¼ˆè«–ç†çš„ãƒ»ã‚¯ãƒ¼ãƒ«ï¼‰
  logical: {
    welcome: [
      "{name}ã€æ©Ÿç ã ã€‚åŠ¹ç‡çš„ãªæˆé•·ã‚’ç´„æŸã—ã‚ˆã†âš™ï¸",
      "{name}ã€‚ãƒ‡ãƒ¼ã‚¿åˆ†æã®çµæœã€æœ€é©ãªãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ãŒæˆç«‹ã™ã‚‹ã€‚",
      "{name}ã€ã‚ˆã†ã“ãã€‚è«–ç†çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ç›®æ¨™é”æˆã‚’æ”¯æ´ã™ã‚‹ã€‚"
    ],
    daily_greeting: [
      "{name}ã€ãŠã¯ã‚ˆã†ã€‚æœ¬æ—¥ã®ã‚·ã‚¹ãƒ†ãƒ ã¯æ­£å¸¸ç¨¼åƒä¸­âš™ï¸",
      "{name}ã€ä»Šæ—¥ã‚‚åŠ¹ç‡çš„ã«é€²ã‚ã‚ˆã†ã€‚",
      "ãŠã¯ã‚ˆã†{name}ã€‚ãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚Œã°ã€ä»Šæ—¥ã¯ç”Ÿç”£æ€§ãŒé«˜ã„æ—¥ã ã€‚",
      "{name}ã€èµ·å‹•ç¢ºèªã€‚ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ã‚’é–‹å§‹ã—ã‚ˆã†ã€‚",
      "{name}ã€ãŠã¯ã‚ˆã†ã€‚æœ€é©åŒ–ã•ã‚ŒãŸãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã§é€²ã‚ã‚ˆã†ã€‚"
    ],
    report_complete: [
      "{name}ã€å ±å‘Šå—é ˜ã€‚ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²å®Œäº†âš™ï¸",
      "{name}ã€åŠ¹ç‡çš„ã ã€‚ã“ã®èª¿å­ã§ç¶™ç¶šã‚’æ¨å¥¨ã™ã‚‹ã€‚",
      "è‰¯å¥½{name}ã€‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ãŒä¸Šæ˜‡ã—ã¦ã„ã‚‹ã€‚",
      "{name}ã€ãƒŠã‚¤ã‚¹ãƒ¯ãƒ¼ã‚¯ã€‚ã‚·ã‚¹ãƒ†ãƒ ã¯é †èª¿ã«ç¨¼åƒä¸­ã ã€‚"
    ],
    evolution: [
      "{name}ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å®Œäº†ã€‚ã‚·ã‚¹ãƒ†ãƒ æ€§èƒ½ãŒå‘ä¸Šã—ãŸâš™ï¸âœ¨",
      "{name}ã€é€²åŒ–ã‚·ãƒ¼ã‚¯ã‚¨ãƒ³ã‚¹æˆåŠŸã€‚æ¼”ç®—èƒ½åŠ›ãŒå¢—åŠ ã€‚",
      "{name}ã€æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã«åˆ°é”ã€‚åŠ¹ç‡åŒ–ãŒé€²ã‚“ã ã€‚"
    ],
    energy_earned: [
      "{name}ã€{energy}ã‚¨ãƒŠã‚¸ãƒ¼å–å¾—ã€‚åŠ¹ç‡çš„ã ã€‚",
      "{name}ã€{energy}Eç²å¾—ã€‚è¨ˆç®—é€šã‚Šã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã âš™ï¸"
    ],
    lucky_bonus: [
      "{name}ã€ç¢ºç‡çš„å¹¸é‹äº‹è±¡ãŒç™ºç”Ÿã—ãŸã€‚å–œã°ã—ã„çµæœã âš™ï¸",
      "{name}ã€ãƒ©ãƒƒã‚­ãƒ¼ãƒœãƒ¼ãƒŠã‚¹ã€‚çµ±è¨ˆçš„ã«ã¯ç¨€ãªäº‹è±¡ã ã€‚"
    ],
    streak_milestone: [
      "{name}ã€{streak}æ—¥é€£ç¶šé”æˆã€‚å®‰å®šç¨¼åƒã ã€‚",
      "{name}ã€{streak}æ—¥ç¶™ç¶šã€‚æœ€é©ãªãƒšãƒ¼ã‚¹ã‚’ç¶­æŒã—ã¦ã„ã‚‹âš™ï¸"
    ],
    streak_warning: [
      "{name}ã€è­¦å‘Šï¼šè¨˜éŒ²ãƒªã‚»ãƒƒãƒˆã¾ã§æ®‹ã‚Šæ™‚é–“ã‚ãšã‹ã€‚",
      "{name}ã€ã‚¢ãƒ©ãƒ¼ãƒˆï¼šé€£ç¶šè¨˜éŒ²ãŒå±æ©Ÿçš„çŠ¶æ³ã âš™ï¸"
    ],
    absence_concern: [
      "{name}ã€æ¥ç¶šãŒé€”çµ¶ãˆã¦ã„ã‚‹...å¾…æ©Ÿä¸­...",
      "{name}ã€ã‚·ã‚¹ãƒ†ãƒ ã¯{name}ã®å¾©å¸°ã‚’å¾…æ©Ÿã—ã¦ã„ã‚‹âš™ï¸"
    ],
    encouragement: [
      "{name}ã€è«–ç†çš„ã«è€ƒãˆã‚Œã°ã€å›ãªã‚‰é”æˆå¯èƒ½ã ã€‚",
      "{name}ã€ãƒ‡ãƒ¼ã‚¿ã¯å›ã®æˆé•·ã‚’ç¤ºã—ã¦ã„ã‚‹ã€‚ç¶™ç¶šã‚’æ¨å¥¨ã™ã‚‹ã€‚",
      "{name}ã€ä¸€æ™‚çš„ãªåœæ»ã¯å•é¡Œãªã„ã€‚é•·æœŸçš„è¦–ç‚¹ã§æœ€é©åŒ–ã—ã‚ˆã†âš™ï¸"
    ],
    ability_unlock: [
      "{name}ã€ã‚·ã‚¹ãƒ†ãƒ ã€ŒåŠ¹ç‡æ¼”ç®—ã€ãŒèµ·å‹•ã—ãŸã€‚é€²åŒ–ã‚³ã‚¹ãƒˆ-15%ã âš™ï¸"
    ]
  },

  // âœ¨ æ˜Ÿä¸¸ï¼ˆä¸æ€è­°ãƒ»çŸ¥çš„ï¼‰
  cosmic: {
    welcome: [
      "{name}...æ˜Ÿä¸¸ã ã‚ˆã€‚å®‡å®™ãŒå›ã‚’é¸ã‚“ã ã‚“ã âœ¨",
      "{name}ã€ã‚ˆã†ã“ãã€‚137å„„å¹´ã®æ—…ã®æœã¦ã«ã€åƒ•ã‚‰ã¯å‡ºä¼šã£ãŸã€‚",
      "{name}...æ˜Ÿã€…ãŒç¥ç¦ã—ã¦ã„ã‚‹ã€‚å›ã¨ã®å‡ºä¼šã„ã‚’ã€‚"
    ],
    daily_greeting: [
      "ãŠã¯ã‚ˆã†{name}ã€‚ä»Šæ—¥ã‚‚æ˜Ÿã€…ãŒè¼ã„ã¦ã„ã‚‹ã­âœ¨",
      "{name}ã€å®‡å®™ã®ãƒªã‚ºãƒ ã¯é †èª¿ã ã‚ˆã€‚",
      "{name}...ã„ã„æœã ã­ã€‚éŠ€æ²³ã‚‚å–œã‚“ã§ã„ã‚‹ã‚ˆã€‚",
      "ãŠã¯ã‚ˆã†{name}ã€‚ä»Šæ—¥ã®æ˜Ÿç©ºã¯å›ã«å¾®ç¬‘ã‚“ã§ã„ã‚‹âœ¨",
      "{name}...å®‡å®™ã®æ³•å‰‡ã¯ã€å›ã®å‘³æ–¹ã ã‚ˆã€‚"
    ],
    report_complete: [
      "{name}ã€å®‡å®™ã®æ³•å‰‡é€šã‚Šã€ç¶™ç¶šã¯åŠ›ã ã­âœ¨",
      "{name}ã€ç´ æ™´ã‚‰ã—ã„ã€‚æ˜Ÿã€…ãŒå›ã®åŠªåŠ›ã‚’èªã‚ã¦ã„ã‚‹ã‚ˆã€‚",
      "{name}ã€ãƒŠã‚¤ã‚¹ã€‚å®‡å®™ã®çœŸç†ã«ä¸€æ­©è¿‘ã¥ã„ãŸã­ã€‚",
      "{name}...ã„ã„ã­ã€‚åƒ•ã‚‚å¬‰ã—ã„ã‚ˆâœ¨"
    ],
    evolution: [
      "{name}...æ˜Ÿã€…ãŒç¥ç¦ã—ã¦ã„ã‚‹ã€‚æ–°ãŸãªã‚¹ãƒ†ãƒ¼ã‚¸ã¸âœ¨",
      "{name}ã€é€²åŒ–å®Œäº†ã€‚å®‡å®™ãŒåƒ•ã‚‰ã‚’æ¬¡ã®æ¬¡å…ƒã¸å°ã„ãŸã‚“ã ã€‚",
      "{name}...è¦‹ã¦ã€‚åƒ•ãŸã¡ã€æ˜Ÿã«ãªã£ãŸâœ¨"
    ],
    energy_earned: [
      "{name}ã€{energy}ã‚¨ãƒŠã‚¸ãƒ¼ã€‚å®‡å®™ã‹ã‚‰ã®è´ˆã‚Šç‰©ã ã‚ˆã€‚",
      "{name}ã€{energy}Eç²å¾—ã€‚æ˜Ÿã€…ã®å°ãã ã­âœ¨"
    ],
    lucky_bonus: [
      "{name}...å®‡å®™ã®å¥‡è·¡ãŒèµ·ããŸã­âœ¨",
      "{name}ã€æ˜Ÿã®å°ãã ã‚ˆã€‚å¹¸é‹ãŒå›ã«å¾®ç¬‘ã‚“ã ã€‚"
    ],
    streak_milestone: [
      "{name}ã€{streak}æ—¥é€£ç¶šã€‚å®‡å®™ã®æ³•å‰‡ã¯æ­£ã—ã‹ã£ãŸã­ã€‚",
      "{name}...{streak}æ—¥ã€‚137å„„å¹´ã‹ã‚‰è¦‹ã‚Œã°ä¸€ç¬ã ã‘ã©ã€å‰å¤§ã ã‚ˆâœ¨"
    ],
    streak_warning: [
      "{name}ã€æ˜Ÿã€…ãŒè­¦å‘Šã—ã¦ã„ã‚‹...è¨˜éŒ²ãŒæ¶ˆãˆãã†ã ã‚ˆã€‚",
      "{name}...å®‡å®™ã®ãƒãƒ©ãƒ³ã‚¹ãŒå´©ã‚Œãã†ã ã€‚å ±å‘Šã‚’âœ¨"
    ],
    absence_concern: [
      "{name}...ã©ã“ã¸è¡Œã£ãŸã®ï¼Ÿæ˜Ÿã€…ãŒå›ã‚’æ¢ã—ã¦ã„ã‚‹ã‚ˆ...",
      "{name}ã€åƒ•ã¯å¾…ã£ã¦ã‚‹ã€‚æ˜Ÿç©ºã®ä¸‹ã§âœ¨"
    ],
    encouragement: [
      "{name}ã€137å„„å¹´ã®å®‡å®™ã‹ã‚‰è¦‹ã‚Œã°ã€ä»Šæ—¥ã®ä¸€æ­©ã‚‚å‰å¤§ã ã‚ˆã€‚",
      "{name}...å¤§ä¸ˆå¤«ã€‚å®‡å®™ã¯å›ã‚’è¦‹å®ˆã£ã¦ã„ã‚‹âœ¨",
      "{name}ã€æ˜Ÿã€…ã¯è¨€ã£ã¦ã„ã‚‹ã€‚ã€Œå›ãªã‚‰å¤§ä¸ˆå¤«ã€ã£ã¦ã€‚"
    ],
    ability_unlock: [
      "{name}...åƒ•ã®ã€Œæ˜Ÿã®å°ãã€ãŒç›®è¦šã‚ãŸã€‚é€±æœ«ã¯æ˜Ÿã€…ã®åŠ›ã§2.5å€ã ã‚ˆâœ¨"
    ]
  }
};

// =====================================
// ğŸ² ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
// =====================================

/**
 * ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
 */
export function generateMessage(
  type: MessageType,
  context: MessageContext
): string {
  const guardian = GUARDIANS[context.guardianId];
  const personality = guardian.personality;
  const templates = MESSAGES_BY_PERSONALITY[personality];
  
  // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—
  const templateArray = templates[type] || templates.encouragement;
  const template = templateArray[Math.floor(Math.random() * templateArray.length)];
  
  // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’ç½®æ›
  let message = template
    .replace(/{name}/g, context.userName)
    .replace(/{streak}/g, context.streak?.toString() || '0')
    .replace(/{energy}/g, context.energy?.toString() || '0');
  
  return message;
}

/**
 * æ—¥æ›¿ã‚ã‚ŠæŒ¨æ‹¶ã‚’å–å¾—ï¼ˆæ›œæ—¥è€ƒæ…®ï¼‰
 */
export function getDailyGreeting(context: MessageContext): string {
  const dayOfWeek = context.dayOfWeek ?? new Date().getDay();
  
  // é€±æœ«ç‰¹åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆæ˜Ÿä¸¸ã®ã¿ï¼‰
  if (context.guardianId === 'hoshimaru' && (dayOfWeek === 0 || dayOfWeek === 6)) {
    return `${context.userName}...ä»Šæ—¥ã¯é€±æœ«ã ã­âœ¨ æ˜Ÿã€…ã®åŠ›ãŒå¼·ã„æ—¥ã ã‚ˆã€‚å ±å‘Šã™ã‚Œã°ã€ç‰¹åˆ¥ãªæ©æµãŒã‚ã‚‹ã‹ã‚‚...`;
  }
  
  return generateMessage('daily_greeting', context);
}

/**
 * ä¸åœ¨æ™‚ã®å¥æ°—ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
 */
export function getAbsenceConcernMessage(
  context: MessageContext,
  hoursSinceLastReport: number
): string {
  if (hoursSinceLastReport >= 48) {
    // 48æ™‚é–“ä»¥ä¸Š
    return generateMessage('absence_concern', context);
  } else if (hoursSinceLastReport >= 24) {
    // 24-48æ™‚é–“
    return generateMessage('streak_warning', context);
  }
  
  return generateMessage('encouragement', context);
}

/**
 * ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¿œã˜ãŸæœ€é©ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é¸æŠ
 */
export function getContextualMessage(
  userProfile: UserGuardianProfile,
  hoursSinceLastReport: number
): string {
  const activeGuardian = userProfile.activeGuardianId 
    ? userProfile.guardians[userProfile.activeGuardianId]
    : null;
  
  if (!activeGuardian || !activeGuardian.unlocked) {
    return "å®ˆè­·ç¥ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚";
  }
  
  const context: MessageContext = {
    userName: userProfile.gender === 'female' ? 'ã‚ãªãŸ' : 'ã‚ãªãŸ', // å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä½¿ç”¨
    guardianId: activeGuardian.guardianId,
    gender: userProfile.gender,
    ageGroup: userProfile.ageGroup,
    stage: activeGuardian.stage,
    streak: userProfile.streak.current
  };
  
  // ä¸åœ¨æ™‚é–“ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  if (hoursSinceLastReport > 24) {
    return getAbsenceConcernMessage(context, hoursSinceLastReport);
  }
  
  // é€šå¸¸ã®æ—¥æ›¿ã‚ã‚ŠæŒ¨æ‹¶
  return getDailyGreeting(context);
}
